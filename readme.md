# Голосование - выбор ресторана для обеда

Дипломный проект по курсу TopJava

#### Реализовано функционал:
* Разделение прав доступа (пользователь, юзер) - базовая аутентификация(пароль не зашифрован)
Для авторизации можно использовать:
Login "User1", Password "User1",
... ...
Login "User6", Password "User6",
Login "Admin", Password "Admin"
Для разлогирования:
http://localhost:8080/login?logout
* ресторан победитель сегодня(*результат голосования - будет два победителя*) 
http://localhost:8080/user/votes/winner
* список ресторанов с предложенным на сегодня меню 
http://localhost:8080/user/restaurants/menu_today
* добавление ресторанов (Запрос для Windows) 
curl -XPOST -H "Content-type: application/json" -d "{\"name\":\"NewRest\"}" http://localhost:8080/admin/restaurants/add
* просмотр всех ресторанов (необходимо отобразить список для добавления новых блюд в конкретный ресторан - *добавился ресторан с id 100046) 
http://localhost:8080/user/restaurants/all
* добавление блюда в новый ресторан (Запрос для Windows) 
curl -XPOST -H "Content-type: application/json" -d "{\"name\":\"Sosisochki\", \"price\":\"100500\", \"restaurantId\":\"100046\"}" http://localhost:8080/admin/dishes/add
* голосование один из пользователей пытается переголосовать - голос будет принят или нет, в зависимости от времени
http://localhost:8080/user/votes/vote?userId=100003&restaurantId=100006

_голосуют три дополнительных пользователя_
http://localhost:8080/user/votes/vote?userId=100007&restaurantId=100046
http://localhost:8080/user/votes/vote?userId=100008&restaurantId=100046
http://localhost:8080/user/votes/vote?userId=100009&restaurantId=100046

_при запросе ресторана победителя результат изменится - теперь будет один новый ресторан_ 
http://localhost:8080/user/votes/winner

#### Реализовано технические моменты:
- индексы

#### Функционал в разработке:
* Валидация - наличие ресторана в списке предложенных сегодня
* Обработать кейсы "ни кто не проголосовал/нет меню на сегодня" - выбрасывание ошибки(?), логирование
* Возврат результатов "голос принят"/"нельзя голосовать повторно"
* добавить свои ошибки - Error Enum
* AOP для обработки ошибок - на контроллеры
* транзакции
* тесты
* свагер
* валидация в jakarta
* путаница с датами - убрать время из таблицы голосования(только дата) + обеспечить один голос уникальным индексом по дате+юзеру
* необходим объект Result для возврата сохранённой сущности/ошибок валидации
* Использование JWT token
* Security блочит h2 консоль после авторизации
* Не отправлять userName в запросе, а брать из авторизации
## Техническая часть

#### Стек технологий
* java 17
* spring-boot 3.0.0
* spring-data-jpa
* spring-test
* spring-security
* H2
* junit, lombok, jackson

#### Описание

Простое **CRUD** приложение 

Администратор может:
* добавить новый ресторан
* ежедневно должен добавлять блюда предложенные на обед

Пользователи могут:
* просмотреть предложенные на сегодня меню ресторанов
* просмотреть ресторан - победитель(по состоянию на момент запроса)
* проголосовать за понравившийся ресторан. Голос принимается в течении суток. Но переголосовать пользователь может только до 11:00. После этого результат голосования конкретного пользователя фиксируется

#### Как запустить у себя (на примере Intellij IDEA)
    ПО - git, JDK17, IntelliJ IDEA, Maven
* Клонировать проекта (https://github.com/k-tropy/topjavadiploma)
* Открыть проект в IntelliJ IDEA
* Затянуть зависимости Maven
* Собрать проект
* Можно запускать(shift + f10)

!!!ВНИМАНИЕ!!!
Используется встроенная БД H2. Схема БД генерируется и наполняется данными при каждом запуске. При этом датой и временем последнего голосования пользователей является момент запуска приложения. Для проверки функционала голосования необходимо удалить голоса из скрипта заполнения данных/запускать до 11:00/поменять текущее время - тогда система даст переголосовать
